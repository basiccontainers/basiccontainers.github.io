<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitHub Actions continuous build and deployment | Basic Containers </title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Collection of resources for developers to get started on Azure">
    
    <link rel="preload" href="/assets/css/0.styles.6514b516.css" as="style"><link rel="preload" href="/assets/js/app.118d21cd.js" as="script"><link rel="preload" href="/assets/js/2.33b91e66.js" as="script"><link rel="preload" href="/assets/js/3.040216d4.js" as="script"><link rel="prefetch" href="/assets/js/10.05c7de4b.js"><link rel="prefetch" href="/assets/js/11.8c5be6a9.js"><link rel="prefetch" href="/assets/js/12.87630292.js"><link rel="prefetch" href="/assets/js/13.88fe2e1e.js"><link rel="prefetch" href="/assets/js/14.17bd1cef.js"><link rel="prefetch" href="/assets/js/15.a78fd5a8.js"><link rel="prefetch" href="/assets/js/16.42e82f68.js"><link rel="prefetch" href="/assets/js/17.59bb41fd.js"><link rel="prefetch" href="/assets/js/4.15d706e6.js"><link rel="prefetch" href="/assets/js/5.f337493f.js"><link rel="prefetch" href="/assets/js/6.4eddf5af.js"><link rel="prefetch" href="/assets/js/7.5494837b.js"><link rel="prefetch" href="/assets/js/8.45c9161c.js"><link rel="prefetch" href="/assets/js/9.e59b2424.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6514b516.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Basic Containers </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="github-actions-continuous-build-and-deployment"><a href="#github-actions-continuous-build-and-deployment" class="header-anchor">#</a> GitHub Actions continuous build and deployment</h1> <p>In this lab you will:</p> <ul><li>Integrate Azure Appservices with Github</li> <li>Create a github actions workflow</li> <li>Chnage the application</li> <li>Workflow is triggers on each push to master</li> <li>A container image  is built and pushed to ACR</li> <li>A AppService redeployment is triggered on successful build</li></ul> <p>A github actions workflow is defined by a YAML (.yml) file in the <code>/.github/workflows/</code> path in your repository. This definition contains the various steps and parameters that are in the workflow. These configurations and setup can be manually setup per project. This involves secret configuration and service principal setup. In this lab we are going to use App Services Deployment center to automate all these tasks with a few clicks<br> <img src="/assets/img/githubactions-deploy.b2b73719.png" alt="webapp"></p> <h2 id="setup"><a href="#setup" class="header-anchor">#</a> Setup</h2> <h3 id="fork-repo"><a href="#fork-repo" class="header-anchor">#</a> Fork repo.</h3> <p>First step is to fork the original repo. The actions workflow will be deployed to this new repo</p> <ul><li>Go to <code>https://github.com/MicrosoftDocs/mslearn-deploy-run-container-app-service</code></li> <li>Click for repo in the top right hand corner
<img src="/assets/img/forkrepo.7129fd62.png" alt="webapp"></li> <li>Clicking should show a forking status
<img src="/assets/img/FORKING.18f6d81a.png" alt="webapp"></li></ul> <p>Next step is to configure our webapp to perform continuous deployment based on our forked repo</p> <h2 id="configure-github-continuous-deployment"><a href="#configure-github-continuous-deployment" class="header-anchor">#</a> Configure github continuous deployment</h2> <p>Once the fork is complete we are now going to link Azrue App services to Github. This will configure a github workflow to build and deploy to Azure Webapps</p> <ul><li>Go to Azure portal and navigate to the App Service. This can be done by the search box in the top of the portal or selecting 'App Services' in the Left hand menu</li> <li>Select the App service and navigate to the <code>Deployment Center</code></li> <li>Select <code>Github Actions Build</code></li> <li>Sign into your github in the 'Github Actions' Section
<img src="/assets/img/setupDeployment.898bc941.png" alt="webapp"></li> <li>You will be prompted to sign into github
<img src="/assets/img/signintogithub.f2589d42.png" alt="webapp"></li> <li>Once signed into Github account  select the organisation, repository and branch the continous deployment should be based upon
<img src="/assets/img/selectrepo.23581e6e.png" alt="webapp"></li> <li>you are prompt to select the Azure Container registry and the name the image will be pushed under
<img src="/assets/img/selectRegistry.74b6bd36.png" alt="webapp"></li> <li>Leave the Startup file emptry</li> <li>You can view the generate Github workflow by clicking &quot;Preview File&quot;
<img src="/assets/img/workflowpreview.dbb95f54.png" alt="webapp"></li> <li>Click  Save: will setup the workflow in the github repo.</li></ul> <h2 id="modify-the-default-work-flow-to-point-to-a-docker-file"><a href="#modify-the-default-work-flow-to-point-to-a-docker-file" class="header-anchor">#</a> Modify the default Work flow to point to a docker file.</h2> <p>The default workflow expects a Dockerfile under the root directory. In the repository there is no dockerfile under root and this result is the initial build will fail. To fix this we need to modify the workflow.</p> <ul><li><p>Edit the workflow file directly in the browser.</p></li> <li><p>Browse to the project github repository under <code>mslearn-deploy-run-container-app-service/.github/workflows</code> and click ``Edit`
<img src="/assets/img/modifyAction.f4fffc07.png" alt="webapp"></p></li> <li><p>Fine the Action  <code>Build and push container image to registry</code> (line:29) Before change</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>   - name: Build and push container image to registry
     uses: docker/build-push-action@v2
     with:
       push: true
       tags: ivanacrdemo.azurecr.io/${{ secrets.AzureAppService_ContainerUsername_7952d75685264c64bf830e10954dbd0d }}/webimage:${{ github.sha }}
       file: ./Dockerfile
</code></pre></div><ul><li>Modify the action entry by adding a parameter/value <code>context: dotnet</code></li> <li>Remove the entry <code>file: ./Dockerfile</code>. this is not needed as it will default to looking for a dockerfile under the <code>context</code> directory</li> <li>The action should now look like this.</li> <li>Important: Only replace the 'file' with the 'context' line. Do not copy the secrets for the 'tags' line. Your secrets will be different and this will break the build.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>    - name: Build and push container image to registry
      uses: docker/build-push-action@v2
      with:
        push: true
        context: dotnet
        tags: ivanacrdemo.azurecr.io/${{ secrets.AzureAppService_ContainerUsername_7952d75685264c64bf830e10954dbd0d }}/webimage:${{ github.sha }}

</code></pre></div><ul><li>Commit changes in the portal
<img src="/assets/img/commitWorkflow.8bf81554.png" alt="webapp"></li> <li>To view if the build is succesful. In github under the project navigate to Actions and the the build, push and deployment should be succesful<br> <img src="/assets/img/resultofbuild.92a045f2.png" alt="webapp"></li></ul> <h2 id="trigger-a-build"><a href="#trigger-a-build" class="header-anchor">#</a> Trigger a build</h2> <p>Now we want to see if our build pipeline really results in our application been redeployed and updated</p> <ul><li>In the project repo.  Modify the html file <code>mslearn-deploy-run-container-app-service/dotnet/SampleWeb/Pages/Index.cshtml</code>. For the sake of simplicity perform these changes in the github UI</li> <li>Simply change the text in   <code>&lt;h1 class=&quot;display-4&quot;&gt;Welcome&lt;/h1&gt;</code> to something else.</li> <li>Update file by committing and push change in the github UI.</li> <li>Once the workflow is complete open the application URL(can be found in the AppService overview in the portal)</li> <li>Confirm changes have been deployed</li></ul> <h2 id="conculsion"><a href="#conculsion" class="header-anchor">#</a> Conculsion</h2> <p>We were able to configure a continuous build and deployment pipeline via Azure Webapps default wizard</p> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ul><li>Patterns container : https://docs.microsoft.com/en-us/azure/app-service/deploy-best-practices#continuously-deploy-containers</li> <li>Github Actions: https://docs.microsoft.com/en-us/azure/app-service/deploy-best-practices#use-github-actions</li> <li>Web app Deployment  https://docs.microsoft.com/en-us/azure/app-service/deploy-ci-cd-custom-container?tabs=acr&amp;pivots=container-linux</li> <li>https://docs.github.com/en/actions/deployment/deploying-to-azure-app-service</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.118d21cd.js" defer></script><script src="/assets/js/2.33b91e66.js" defer></script><script src="/assets/js/3.040216d4.js" defer></script>
  </body>
</html>
