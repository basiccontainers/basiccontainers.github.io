(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{416:function(e,a,t){"use strict";t.r(a);var n=t(46),s=Object(n.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"deploy-cusotmer-container-from-acr-to-kubernetes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-cusotmer-container-from-acr-to-kubernetes"}},[e._v("#")]),e._v(" Deploy cusotmer container from ACR to Kubernetes")]),e._v(" "),t("p",[e._v("In this lab you will deploy a custom container from ACR into AKS. In this scenario.")]),e._v(" "),t("h2",{attrs:{id:"deploy-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-application"}},[e._v("#")]),e._v(" Deploy application")]),e._v(" "),t("p",[e._v("To pull down credentials execute the following command")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az aks get-credentials --resource-group $RESOURCE_GROUP --name $AKS_CLUSTER\n")])])]),t("h3",{attrs:{id:"create-an-application-in-kubernetes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-an-application-in-kubernetes"}},[e._v("#")]),e._v(" Create an application in kubernetes")]),e._v(" "),t("p",[e._v('The easiest way to deploy and application in kubernetes is to use the helper command "create". This command will generate a kubernetes manifest file and push the configuration to kubernetes api. https://kubernetes.io/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/')]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl  create deployment myapp --image  $registry.azurecr.io/webimage:v2\n")])])]),t("p",[e._v("Verify deployment running by calling "),t("code",[e._v("kubectl get po")])]),e._v(" "),t("p",[t("code",[e._v("ivan@Azure:~$ kubectl get po NAME READY STATUS RESTARTS AGE myapp-84c499bdff-2xzw7 1/1 Running 0 10s")]),e._v("\nAlternatively another way to deploy is to fist generate the manifest file and then modify locally")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ivan@Azure:~$ kubectl  create deployment myapp --image  ivanacrdemo.azurecr.io/webimage:v2 --dry-run=client -o yaml \napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: myapp\n  name: myapp\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: myapp\n  strategy: {}\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: myapp\n    spec:\n      containers:\n      - image: ivanacrdemo.azurecr.io/webimage:v2\n        name: webimage\n        resources: {}\nstatus: {}\nivan@Azure:~$\n")])])]),t("p",[e._v("The output can then be modified (changing names, adding labels ) and then pushed to kubernetes using the apply command "),t("code",[e._v("kubectl apply -f deployment.yaml")])]),e._v(" "),t("h2",{attrs:{id:"expose-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expose-application"}},[e._v("#")]),e._v(" Expose application")]),e._v(" "),t("p",[e._v("Now that our application is running in kubernetes we want to make it accessible and consumable from outside the cluster.")]),e._v(" "),t("ul",[t("li",[e._v("Execute the following command to expose the application on a Azure public loadbalancer")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl  expose deployment myapp --type=LoadBalancer --port 80\n")])])]),t("ul",[t("li",[e._v("The application will be available of a public Ip. To disocver the ip execute the "),t("code",[e._v("kubectl get svc")]),e._v(" command. The app is now available under external IP")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ivan@Azure:~$ kubectl get svc\nNAME         TYPE           CLUSTER-IP    EXTERNAL-IP    PORT(S)        AGE\nkubernetes   ClusterIP      10.0.0.1      <none>         443/TCP        4d3h\nmyapp        LoadBalancer   10.0.24.225   20.82.81.137   80:30924/TCP   7m32s\nivan@Azure:~\n")])])]),t("h2",{attrs:{id:"extra-expose-the-application-on-a-ingress-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#extra-expose-the-application-on-a-ingress-controller"}},[e._v("#")]),e._v(" Extra: Expose the application on a ingress controller")]),e._v(" "),t("p",[e._v("kubernetes as the concept of a exposing all ingress traffic within a central location. Instead of all applications exposing public ips instead applications are exposed on a single ingress ip and then routed to the back end application. In this extra task try deploy you application on an ingress controller")]),e._v(" "),t("h3",{attrs:{id:"hints"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hints"}},[e._v("#")]),e._v(" Hints")]),e._v(" "),t("ul",[t("li",[e._v("Deploy a ingress controller (nginx)")]),e._v(" "),t("li",[e._v("Create a Ingress manifest for your app")]),e._v(" "),t("li",[e._v("Deploy application under a unique path (routing rule)")])]),e._v(" "),t("p",[e._v("See")]),e._v(" "),t("ul",[t("li",[e._v("https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/")]),e._v(" "),t("li",[e._v("https://kubernetes.io/docs/concepts/services-networking/ingress/")])]),e._v(" "),t("h2",{attrs:{id:"summary"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[e._v("#")]),e._v(" Summary")]),e._v(" "),t("p",[e._v("In this lab we succesfully deployed our custom application and exposed it publically")]),e._v(" "),t("h2",{attrs:{id:"references"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),t("ul",[t("li",[e._v("https://kubernetes.io/docs/concepts/services-networking/service/")]),e._v(" "),t("li",[e._v("https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/")]),e._v(" "),t("li",[e._v("https://kubernetes.io/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/")])])])}),[],!1,null,null,null);a.default=s.exports}}]);